<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Loading application</title>
</head>
<body>
<H1 id="progress"></H1>

<h1>Daniel is a stinky bum</h1>
</body>
<script>
    // Load the components 1 by 1 so that we don't hammer the ESP
    // which can only handle 1 request at a time
    var sources = [
        "jquery.min.js",
        "bootstrap.bundle.min.js",
        "scripts.js",
        "feather.min.js",
        "highcharts.js",
        "highcharts-more.js",
        "windbarb.js",
    ];
    var idx = 0;
    var downloadComplete = true;
    var progress = document.getElementById("progress");

    function getNextSource(){
        var source = sources[idx];
        var req = new XMLHttpRequest();
        downloadComplete = false;
        progress.innerHTML = "Downloading: " + source;
        req.addEventListener('readystatechange', function(e) {
            if(req.readyState == 2 && req.status == 200) {
                // Download will start
            }
            else if(req.readyState == 3) {
                // Download is happening
            }
            else if(req.readyState == 4) {
                // Downloading has finished
                var script = document.createElement('script');
                script.innerHTML = req.response;
                document.body.appendChild(script);
                downloadComplete = true;
                idx++;
            }
        });

        // progress percent of file
        req.addEventListener('progress', function(e) {
            if(e.lengthComputable === true) {
                var download_percent = (e.loaded / e.total)*100;
                console.log(download_percent);
            }
        });

        req.responseType = 'text';
        req.open('GET', source);
        req.send();
    }

    var ticktimer = setInterval(function ()
    {
        if (idx >= sources.length){
            clearInterval(ticktimer);
            alert("All files downloaded");
        } else {
            if (downloadComplete){
                getNextSource();
            }
        }
    },500);
    //feather.replace();
</script>
</html>